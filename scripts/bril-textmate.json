{
  "name": "bril",
  "scopeName": "source.bril",
  "fileTypes": [
    "bril"
  ],
  "patterns": [
    {
      "include": "#comment"
    },
    {
      "include": "#function"
    }
  ],
  "repository": {
    "comment": {
      "patterns": [
        {
          "match": "#.*$",
          "name": "comment.line"
        }
      ]
    },
    "function": {
      "patterns": [
        {
          "begin": "^\\s*@(\\w+)(?:\\((?:(\\s*\\w+\\s*)(?:\\s*,\\s*)?)?\\))?\\s*\\{",
          "beginCaptures": {
            "1": {
              "name": "entity.name.function"
            },
            "2": {
              "name": "variable.parameter"
            }
          },
          "end": "\\}",
          "name": "meta.function.bril",
          "patterns": [
            {
              "include": "#comment"
            },
            {
              "include": "#label_def"
            },
            {
              "include": "#effect_instruction"
            },
            {
              "include": "#assignment"
            }
          ]
        },
        {
          "begin": "^\\s*@(\\w+)\\(((?:\\s*\\w+\\s*,\\s*)+)(\\s*\\w+\\s*)(?:\\s*,\\s*)?\\)\\s*\\{",
          "beginCaptures": {
            "1": {
              "name": "entity.name.function"
            },
            "2": {
              "patterns": [
                {
                  "include": "#arg_list"
                }
              ]
            },
            "3": {
              "name": "variable.parameter"
            }
          },
          "end": "\\}",
          "name": "meta.function.bril",
          "patterns": [
            {
              "include": "#comment"
            },
            {
              "include": "#label_def"
            },
            {
              "include": "#effect_instruction"
            },
            {
              "include": "#assignment"
            }
          ]
        }
      ]
    },
    "arg_list": {
      "patterns": [
        {
          "match": "(\\s*\\w+\\s*),\\s*",
          "captures": {
            "1": {
              "name": "variable.parameter"
            }
          }
        },
        {
          "match": "(\\s*\\w+\\s*),\\s*((?:\\s*\\w+\\s*,\\s*)+)",
          "captures": {
            "1": {
              "name": "variable.parameter"
            },
            "2": {
              "patterns": [
                {
                  "include": "#arg_list"
                }
              ]
            }
          }
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "match": "(true|false)",
          "name": "constant.boolean"
        },
        {
          "match": "-?[0-9]+(?:\\.[0-9]+)?",
          "name": "constant.numeric"
        }
      ]
    },
    "label": {
      "patterns": [
        {
          "match": "(\\.[\\w|\\.]+)",
          "captures": {
            "1": {
              "name": "entity.name.class"
            }
          }
        }
      ]
    },
    "label_def": {
      "patterns": [
        {
          "begin": "^(\\.[\\w|\\.]+):\\s*",
          "end": "$",
          "beginCaptures": {
            "1": {
              "name": "entity.name.class"
            }
          }
        }
      ]
    },
    "variable": {
      "patterns": [
        {
          "match": "\\b\\w+\\b"
        }
      ]
    },
    "types": {
      "patterns": [
        {
          "match": "(int|bool|float|char)",
          "name": "storage.type"
        }
      ]
    },
    "assignment": {
      "patterns": [
        {
          "match": "\\s*(\\b\\w+\\b)\\s*(?::\\s*(\\w+))?\\s*=\\s*(.*);",
          "name": "meta.assignment.bril",
          "captures": {
            "2": {
              "patterns": [
                {
                  "include": "#types"
                }
              ]
            },
            "3": {
              "patterns": [
                {
                  "include": "#value_instruction"
                }
              ]
            }
          }
        }
      ]
    },
    "arg_slots": {
      "patterns": [
        {
          "match": "\\s*([^\\s]+)\\s*",
          "captures": {
            "1": {
              "patterns": [
                {
                  "include": "#constants"
                },
                {
                  "include": "#variable"
                },
                {
                  "include": "#label"
                }
              ]
            }
          }
        },
        {
          "match": "((?:\\s*[^\\s]+\\s+)+)([^\\s]+)\\s*",
          "captures": {
            "2": {
              "patterns": [
                {
                  "include": "#constants"
                },
                {
                  "include": "#variable"
                },
                {
                  "include": "#label"
                }
              ]
            },
            "1": {
              "patterns": [
                {
                  "include": "#arg_slots"
                }
              ]
            }
          }
        }
      ]
    },
    "effect_instruction": {
      "patterns": [
        {
          "match": "\\s*(jmp|br|ret|print|nop|speculate|guard|commit)\\s*(.*);",
          "name": "meta.instruction.effect.bril",
          "captures": {
            "1": {
              "name": "keyword"
            },
            "2": {
              "patterns": [
                {
                  "include": "#arg_slots"
                }
              ]
            }
          }
        }
      ]
    },
    "value_instruction": {
      "patterns": [
        {
          "match": "\\s*(id|const|add|mul|sub|div|eq|lt|gt|le|ge|not|and|or)\\s*(.*)",
          "name": "meta.instruction.value.bril",
          "captures": {
            "1": {
              "name": "keyword"
            },
            "2": {
              "patterns": [
                {
                  "include": "#arg_slots"
                }
              ]
            }
          }
        }
      ]
    }
  }
}
